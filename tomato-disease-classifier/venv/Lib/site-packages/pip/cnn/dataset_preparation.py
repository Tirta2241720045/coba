import tensorflow as tf
import os

# Konfigurasi parameter
IMG_HEIGHT = 224
IMG_WIDTH = 224
BATCH_SIZE = 32


def create_dataset(data_dir):
    dataset = tf.keras.preprocessing.image_dataset_from_directory(
        data_dir,
        validation_split=0.2,
        subset="training",
        seed=123,
        image_size=(IMG_HEIGHT, IMG_WIDTH),
        batch_size=BATCH_SIZE,
    )

    val_dataset = tf.keras.preprocessing.image_dataset_from_directory(
        data_dir,
        validation_split=0.2,
        subset="validation",
        seed=123,
        image_size=(IMG_HEIGHT, IMG_WIDTH),
        batch_size=BATCH_SIZE,
    )

    class_names = dataset.class_names

    # Simpan class_names ke file requirements/class_names.txt
    requirements_dir = os.path.join(os.path.dirname(__file__), "requirements")
    os.makedirs(requirements_dir, exist_ok=True)
    class_names_file = os.path.join(requirements_dir, "class_names.txt")

    # Hapus file lama jika ada, lalu tulis class_names yang baru
    if os.path.exists(class_names_file):
        os.remove(class_names_file)
    with open(class_names_file, "w") as f:
        for name in class_names:
            f.write(f"{name}\n")

    return dataset, val_dataset
